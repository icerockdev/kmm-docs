# coroutines

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –Ω–∞ –Ω–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [kotlinx.coroutines](https://github.com/Kotlin/kotlinx.coroutines) –≤–µ—Ä—Å–∏–∏ native-mt.

## –ú–∞—Ç–µ—Ä–∏–∞–ª—ã

### Beginner

- üìÑ [KotlinLang Docs - Coroutines guide](https://kotlinlang.org/docs/coroutines-basics.html)
  - suspend —Ñ—É–Ω–∫—Ü–∏–∏
  - scope builder'—ã - runBlocking, coroutineScope
  - Structured Concurrency
  - –õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å –∫–æ—Ä—É—Ç–∏–Ω
- üé¶ [–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ù–æ–∑–∏–∫. –ö–æ–µ-—á—Ç–æ –æ –∫–æ—Ä—É—Ç–∏–Ω–∞—Ö](https://www.youtube.com/watch?v=t0AERgx0lrY)
  - –ù–∞–≥–ª—è–¥–Ω–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ —á—Ç–æ —Ç–∞–∫–æ–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ
  - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ –æ–±–ª–∞—Å—Ç–∏ –∫–æ—Ä—É—Ç–∏–Ω
  - –ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å–æ–≤–µ—Ä—à–∞—é—Ç –Ω–æ–≤–∏—á–∫–∏
  - –ö–∞–∫–∏–µ —Ö–∏—Ç—Ä–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ—Ä—É—Ç–∏–Ω—ã
- üé¶ [–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ù–æ–∑–∏–∫. –ö–æ–µ-—á—Ç–æ –æ –∫–æ—Ä—É—Ç–∏–Ω–∞—Ö. Flow, Scope](https://www.youtube.com/watch?v=AAFi_C40BOM)
  - Flow, Channel
  - CoroutineScopes
- üìÑ [kotlinlang docs - Coroutines guide](https://kotlinlang.org/docs/coroutines-guide.html)
  - ...
- üé¶ [RedMadRobot - Coroutines. –•–∞–æ—Ç–∏—á–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ. –ß–∞—Å—Ç—å 1](https://www.youtube.com/watch?v=cHERit7LNGM)
  - Inject Dispatchers,
  - Dispatcher,
  - withContext,
  - NonCancellable,
  - viewModelScope –∏ –¥—Ä—É–≥–∏–µ,
  - –î–µ–ª–∞–π suspend —Ñ—É–Ω–∫—Ü–∏–∏ main-safe,
  - ViewModel –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ—Ä—É—Ç–∏–Ω—ã,
  - StateFlow –∏ SharedFlow,
  - –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–π –º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ —Ç–∏–ø—ã,
  - –ö–∞–∫ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –≤–æ view,
  - Data –∏ Domain —Å–ª–æ–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç suspend –∏ Flow,
  - C–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä—É—Ç–∏–Ω –≤ Data –∏ Domain —Å–ª–æ—è—Ö
- üé¶ [RedMadRobot - Coroutines. –•–∞–æ—Ç–∏—á–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ. –ß–∞—Å—Ç—å 2](https://www.youtube.com/watch?v=6Apj_v9ZkBs)
  - –ö–∞–∫ –∂–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ—Ä—É—Ç–∏–Ω—ã –≤ Data –∏ Domain —Å–ª–æ—è—Ö
  - coroutineScope –∏ supervisorScope
  - Job
  - Deferred –∏ async/await
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–∫–æ—É–ø–∞
  - –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–∫–æ—É–ø
  - –ò–∑–±–µ–≥–∞–π GlobalScope
  - CoroutineScope
  - CoroutineContext
  - CoroutineScope vs CoroutineContext
  - –î–µ–ª–∞–π —Å–≤–æ–∏ –∫–æ—Ä—É—Ç–∏–Ω—ã cancellable
  - –ü–æ–º–Ω–∏ –ø—Ä–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è 
- üé¶ [RedMadRobot - Coroutines. –•–∞–æ—Ç–∏—á–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ. –ß–∞—Å—Ç—å 3](https://www.youtube.com/watch?v=7JSHSqAhErw)
  - –î–ª—è —á–µ–≥–æ –±—ã–ª –Ω—É–∂–µ–Ω SingleLiveEvent üìü
  - –ö–∞–∫ –µ–≥–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–µ–∑ LiveData üî´
  - Channel (–∫–∞–∂–µ—Ç—Å—è —ç—Ç–æ —Å–ø–æ–π–ª–µ—Ä üòÜ)
  - –û —Ç—Ä–∞—Ç–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ –±–µ–∫–≥—Ä–∞—É–Ω–¥–µ üî¶
  - buffer, conflate, flowOn, shareIn
  - WhileSubscribed
  - –ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–ª—É—à–∞—Ç—å Flow –∏–∑ UI ‚úÖ
  - –ò –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã üõ†
  - Lifecycle.repeatOnLifecycle
  - Flow.flowWithLifecycle

### Intermediate

- üé¶ [KotlinConf 2019: Asynchronous Data Streams with Kotlin Flow by Roman Elizarov](https://www.youtube.com/watch?v=tYcqn48SMT8)
- üìÑ [Guide to UI programming with coroutines](https://github.com/Kotlin/kotlinx.coroutines/blob/master/ui/coroutines-guide-ui.md)
- üìÑ [–ö–æ—Ä—É—Ç–∏–Ω—ã –≤ Kotlin (–≥–∞–π–¥)](https://habr.com/ru/company/alfa/blog/336228/)
- üìÑ [Best practices for coroutines](https://developer.android.com/kotlin/coroutines/coroutines-best-practices)
- üìÑ [–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è native-mt –≤–µ—Ä—Å–∏–∏ –¥–ª—è iOS —Ç–∞—Ä–≥–µ—Ç–∞](https://github.com/Kotlin/kotlinx.coroutines/blob/native-mt/kotlin-native-sharing.md).
- üìÑ [Roman Elizarov - Structured Concurrency](https://elizarov.medium.com/structured-concurrency-722d765aa952)
- üìÑ [Structured Concurrency in action! (using Kotlin coroutines)](https://proandroiddev.com/structured-concurrency-in-action-97c749a8f755?gi=85a83dfe8ceb)
- üé¶ [Roman Elizarov ‚Äî Structured concurrency](https://www.youtube.com/watch?v=Mj5P47F6nJg)

### Advanced

- üé¶ [–ê–Ω–¥—Ä–µ–π –ë—Ä–µ—Å–ª–∞–≤ ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ –ø–æ–Ω—è—Ç–Ω–æ. –°–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ Kotlin](https://www.youtube.com/watch?v=ffIVVWHpups)
  - –ù–µ–º–Ω–æ–≥–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ, –Ω–æ –ø—Ä–æ –≤–Ω—É—Ç—Ä—è–Ω–∫—É –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ.
- üé¶ [–ö–æ—Ä—É—Ç–∏–Ω—ã –≤ Kotlin ‚Äî –†–æ–º–∞–Ω –ï–ª–∏–∑–∞—Ä–æ–≤, JetBrains](https://www.youtube.com/watch?v=b4mBmi1QNF0)
- üìÑ [Coroutines Codegen](https://github.com/JetBrains/kotlin/blob/document-coroutines-codegen/compiler/backend/src/org/jetbrains/kotlin/codegen/coroutines/coroutines-codegen.md#state-machine)
  - –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å suspend –∫–æ–¥–æ–º –∏ —á—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

## Highlights

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

> –ú—ã –Ω–µ —Å—Ç—Ä–µ–º–∏–º—Å—è –∑–¥–µ—Å—å –¥–∞—Ç—å –ø–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º, –Ω–æ –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Å–º—ã—Å–ª —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –æ—á–µ–Ω—å –≤–∞–∂–µ–Ω.
> 
> –°–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç —è–∑—ã–∫–æ–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã, —Å—Ä–µ–¥—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è), –∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞. –í –ø—Ä–∏–Ω—Ü–∏–ø–µ, –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è, –Ω–æ –º—ã –Ω–µ –±—É–¥–µ–º –≤–¥–∞–≤–∞—Ç—å—Å—è –≤ —ç—Ç–∏ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å) –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç, –≥–¥–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –≤—ã–∑–æ–≤–∞–º. –ü—Ä—è–º–æ –ø–µ—Ä–µ–¥ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º –∫–ª–∞—Å—Å–∞ –≤–º–µ—Å—Ç–µ —Å —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ —Ç. –¥. –ü—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, –∏ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.
> 
> –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—É –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–∞–∫ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –µ—ë –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –¢–∏–ø–æ–º —Ç–∞–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —è–≤–ª—è–µ—Ç—Å—è Continuation, –∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞, –æ–ø–∏—Å–∞–Ω–Ω–æ–µ –∑–¥–µ—Å—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É Continuation-passing style. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–∏–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø–∞ Continuation (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º.
> 
> –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ –æ —Ç–æ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã, –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ. –ü–æ—Ö–æ–∂–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è async / await –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö (—Ç–∞–∫–∏—Ö –∫–∞–∫ C# –∏–ª–∏ ECMAScript 2016) –∞–∫—Ç—É–∞–ª—å–Ω—ã –∏ –∑–¥–µ—Å—å, —Ö–æ—Ç—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –º–æ–≥—É—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Å–æ–ø—Ä–æ–≥—Ä–∞–º–º Kotlin.

[Source](https://kotlinlang.ru/docs/reference/coroutines.html).

–ü—Ä–∏–º–µ—Ä –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:

–ò—Å—Ö–æ–¥–Ω–∏–∫:
```kotlin
dummy() // suspend
println(1)
dummy() // suspend
println(2)
```

–ü—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤:
```kotlin
val $result: Any? = null
when (this.label) {
    0 -> {
        this.label = 1
        $result = dummy(this)
        if ($result == COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED
        goto 1
    }
    1 -> {
        println(1)
        this.label = 2
        $result = dummy(this)
        if ($result == COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED
        goto 2
    }
    2 -> {
        println(2)
        return Unit
    }
    else -> {
        throw IllegalStateException("call to 'resume' before 'invoke' with coroutine")
    }
}
```

–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–µ](https://github.com/JetBrains/kotlin/blob/document-coroutines-codegen/compiler/backend/src/org/jetbrains/kotlin/codegen/coroutines/coroutines-codegen.md#state-machine)

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å [—Å—Ç–∞—Ç—å—é –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ](https://manuelvivo.dev/suspend-modifier).

### CoroutineScope

[CoroutineScope](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/index.html) 
–∑–∞–¥–∞–µ—Ç –æ–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –∫–æ—Ä—É—Ç–∏–Ω—ã. –ò–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è —Å–∫–æ—É–ø –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö
–æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É –∂–∏–∑–Ω–µ–Ω–Ω–æ–º—É —Ü–∏–∫–ª—É.

–ù–∞–ø—Ä–∏–º–µ—Ä, —É –∫–∞–∂–¥–æ–π `ViewModel` –µ—Å—Ç—å `viewModelScope` - —ç—Ç–æ `CoroutineScope`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏
—Å–æ–∑–¥–∞–Ω–∏–∏ `ViewModel` –∏ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `onCleared`. 

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–µ–±–æ–ª—å—à—É—é —Ç–µ—Å—Ç–æ–≤—É—é `ViewModel`:
```kotlin
class TestViewModel: ViewModel() {
  init {
    viewModelScope.launch {
      delay(10000)
      println("work done!")
    }
  }
}
```

–ï—Å–ª–∏ –º—ã –∑–∞–π–¥–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —ç—Ç—É `ViewModel`, –∏ —Å—Ä–∞–∑—É —É–π–¥–µ–º (–Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å 10 —Å–µ–∫—É–Ω–¥), —Ç–æ
—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ –≤ –ª–æ–≥. –ê –µ—Å–ª–∏ –ø–æ–¥–æ–∂–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ - –±—É–¥–µ—Ç. –≠—Ç–æ –∫–∞–∫ —Ä–∞–∑ –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∏
–≤—ã–∑–æ–≤–µ `onCleared` –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è `CoroutineScope`, –∞ –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º –∏ –≤—Å–µ –µ–≥–æ –∫–æ—Ä—É—Ç–∏–Ω—ã. –ê –≤—ã–∑–æ–≤ `onCleared`
–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–º —É—Ö–æ–¥–µ —Å —ç–∫—Ä–∞–Ω–∞ (–ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º `ViewModel`).

–¢–∞–∫–∂–µ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —á—Ç–æ —Å–∫–æ—É–ø –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–º (–ª—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è). 
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Å–∫–æ—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–ª–¥–µ—Ä `coroutineScope`. –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–∫–æ—É–ø–∞
–æ—Ç–º–µ–Ω—è—é—Ç—Å—è –∏ –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ.

–í–ª–æ–∂–µ–Ω–Ω—ã–π —Å–∫–æ—É–ø –º–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –≤ —Å–ª—É—á–∞—è—Ö, –∫–æ–≥–¥–∞ –≤–∞–º –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–≥–æ `CoroutineScope`,
–Ω–æ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –±–∏–ª–¥–µ—Ä–æ–≤ (`launch`/`async`).

```kotlin
suspend fun doSomeParallelWork() {
    coroutineScope {
        val task1 = async { callFirstRequest() }
        val task2 = async { callSecondRequest() }
        awaitAll(task1, task2)
    }
}
```

–í—Å–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–∞–∫–æ–º—É –ª–∏–±–æ —Å–∫–æ—É–ø—É. –°–∫–æ—É–ø –ª–∏–±–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é
(–≤—ã–∑–æ–≤–æ–º `CoroutineScope`), –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `GlobalScope`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ
—Ü–∏–∫–ª–∞ - –∂–∏–≤–µ—Ç –≤—Å–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–µ–∑
—Ç–≤–µ—Ä–¥–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —á—Ç–æ —ç—Ç–æ –≤–µ—Ä–Ω–æ.   

### CoroutineContext

TODO

### Dispatcher

TODO

### –ú–µ—Ö–∞–Ω–∏–∫–∞ delay

–ü–æ –Ω–∞—á–∞–ª—É `delay` –≤—Å–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç –∫–∞–∫ `Thread.sleep` –∏ —Å—á–∏—Ç–∞—é—Ç —á—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –±—É–¥–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
–Ω–∞ N –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥.
–ù–æ [—ç—Ç–æ –Ω–µ —Ç–∞–∫](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/delay.html)
. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –∫–æ–¥–∞:

```kotlin
suspend fun startTimer() {
    println("show message at start")
    delay(1000)
    println("show message after second")
}
```

–ü—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã–π –∫–æ–¥ –±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω (–µ—Å–ª–∏ —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å) –≤ –Ω–µ—á—Ç–æ –ø–æ—Ö–æ–∂–µ–µ –Ω–∞:

```kotlin
fun startTimer() {
    println("show message at start")
    delayCallback(1000) {
        println("show message after second")
    }
}
```

–¢–æ –µ—Å—Ç—å –≤–º–µ—Å—Ç–æ –≤—ã–∑–æ–≤–∞ `sleep` –Ω–∞ –≤–µ—Å—å –ø–æ—Ç–æ–∫, –≤—Å—è —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ suspend-point (`delay` —ç—Ç–æ suspend
—Ñ—É–Ω–∫—Ü–∏—è), –±—É–¥–µ—Ç "–∑–∞–≤–µ—Ä–Ω—É—Ç–∞ –≤ callback", –∑–∞–∫–∏–Ω—É—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ (—á–µ—Ä–µ–∑ Dispatcher
–∫–æ—Ä—É—Ç–∏–Ω) –∏ –¥–∞–Ω–Ω—ã–π –∫–∞–ª–±–µ–∫ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –¥–∏—Å–ø–∞—Ç—á–µ—Ä–æ–º).

–í—ã–≤–æ–¥ - –≤—ã–∑–æ–≤ `delay` –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ—Ç–æ–∫–∞.

## Check Yourself

TODO
