<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-university docs-doc-id-icerock-basics/multimodularity">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-91G2XYQTXS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-91G2XYQTXS",{})</script><title data-rh="true">Многомодульность | Kotlin Multiplatform Mobile</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kmm.icerock.dev/university/icerock-basics/multimodularity"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-university-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-university-current"><meta data-rh="true" property="og:title" content="Многомодульность | Kotlin Multiplatform Mobile"><meta data-rh="true" name="description" content="Многомодульность"><meta data-rh="true" property="og:description" content="Многомодульность"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kmm.icerock.dev/university/icerock-basics/multimodularity"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/university/icerock-basics/multimodularity" hreflang="en"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/university/icerock-basics/multimodularity" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.893f3d2c.css">
<link rel="preload" href="/assets/js/runtime~main.22da4016.js" as="script">
<link rel="preload" href="/assets/js/main.2311b54d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/onboarding/intro">Onboarding</a><a class="navbar__item navbar__link" href="/learning/intro">Knowledge Base</a><a class="navbar__item navbar__link navbar__link--active" href="/university/intro">University</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/icerockdev/kmm.icerock.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/university/intro">IceRock KMM University</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/android-basics/android-intro">1. Основы разработки Android приложений</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/ios-basics/ios-intro">2. Основы разработки iOS приложений</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/kotlin-multiplatform-mobile/kmm-intro">3. Основы разработки Kotlin Multiplatform Mobile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/university/icerock-basics/icerock-intro">4. Основы мобильной разработки в IceRock</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/icerock-intro">Вводная</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/mobile-moko-boilerplate">Шаблон для новых проектов</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/gradle">Gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/university/icerock-basics/multimodularity">Многомодульность</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/moko-libs-intro">Введение в MOKO библиотеки</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/di">Внедрение зависимостей</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/mvvm">MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/resources-in-common">Ресурсы в общем коде</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/navigation">Навигация между экранами</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/ios-resources">Ресурсы на iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/ui-units">Построение экранов вертикальными списками</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/logging-and-errors">Логирование и обработка ошибок</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/android-just-like-ios">Android ≈ iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/repository">Реактивный источник данных</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/mock-engine">Мокирование данных</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/entities">Сущности приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/practice">Практическое задание</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/filling-fields/intro">5. Реализация форм ввода данных</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/lists/intro">6. Реализация списков с данными</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/network/intro">7. Передача данных по сети</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/data-storage/intro">8. Хранение данных</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/runtime-permissions/intro">9. Runtime permissions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/push-notifications/intro">10. Push notifications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/memos/best-practices">Памятки для разработчика</a></div></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">4. Основы мобильной разработки в IceRock</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Многомодульность</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Многомодульность</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="многомодульность-1">Многомодульность<a class="hash-link" href="#многомодульность-1" title="Direct link to heading">​</a></h2><p>Мы в IceRock придерживаемся подхода многомодульности.  </p><ul><li><p><strong><em>Что такое многомодульность?</em></strong></p><ul><li>В <code>gradle</code> многомодульность - это когда один <code>gradle</code>-проект состоит из нескольких других <code>gradle</code>-проектов, которые имеют друг с другом связи и вместе собираются в некоторое приложение. </li><li>В <code>iOS-мире</code> многомодульность - это когда проект разбит по отдельным библиотекам(фреймворкам). Есть таргет приложения, а есть отдельные таргеты библиотек, которые как-то там подключены к приложению, как-то между собой связаны и т.д.</li></ul><p>И там и там многомодульность ускоряет время сборки проекта, а также позволяет переиспользовать функционал модулей между проектами. В наших проектах многомодульность на <code>iOS</code> не используется, поэтому далее мы всегда будем говорить о многомодульности для <code>gradle</code>-проектов.</p></li><li><p><strong><em>Что такое модуль?</em></strong></p><ul><li>Модуль - это объединенные одной задачей классы, функции, интерфейсы, структуры и тд., объединенные в один <code>gradle</code>-проект. Модули могут зависеть от других модулей, однако делать это нужно только тогда, когда это действительно необходимо.<br>Модуль знает о других модулях только то, что ему нужно для корректной работы в рамках самого себя.   </li></ul></li><li><p><strong><em>Примеры модулей:</em></strong></p><ul><li><code>common</code> код - мультиплатформенный модуль</li><li>фичи приложения - отдельные модули</li><li>модуль с общими моделями для разных фичей</li></ul></li><li><p><strong><em>Зачем вообще эти модули? Пусть бы все лежало в одном месте?</em></strong></p><ul><li>Причина - время сборки <code>iOS</code>-приложения, <a href="https://youtu.be/kO8RDq6OoV4?t=1429" target="_blank" rel="noopener noreferrer">видео-описание</a> проблемы</li></ul></li></ul><p>Начнем с разбора процесса сборки проекта для <code>iOS</code> и <code>Android</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="сборка-android">Сборка Android<a class="hash-link" href="#сборка-android" title="Direct link to heading">​</a></h2><p>За сборку на <code>Android</code> отвечает <code>Gradle</code> и компилятор <code>Kotlin/JVM</code>. <code>Gradle</code> умеет хранить кеш уже собранного ранее модуля. Ориентируясь на это, он может определять какие модули действительно изменились или зависят от изменившихся. <code>Kotlin/JVM</code> поддерживает инкрементальную компиляцию.  </p><p>Если в двух словах, то это похоже на кеши гредла, только он хранит свои собственные, промежуточные файлы компиляции. Гредлу эти файлы недоступны, он по ним не сможет сделать никаких выводов. Почитать подробнее можно <a href="https://blog.jetbrains.com/kotlin/2020/09/the-dark-secrets-of-fast-compilation-for-kotlin/" target="_blank" rel="noopener noreferrer">тут</a>. Таким образом, ориентируясь на них, и на то, какие изменения были сделаны (в <code>public</code> или <code>private api</code>) <code>Kotlin/JVM</code> может пересобирать только реально изменившийся файл и добавлять его к уже собранным файлам. Те, кто от него зависят будут пересобраны только в случае изменений в <code>public api</code>.</p><p>Рассмотрим, как происходит компиляция <code>Android-проекта</code>. Градл, получив команду скомпилировать проект (задача <code>:assembleDevDebug</code> для <code>Build Variant: devDebug</code>) выполняет следующие действия, используя компилятор <code>Kotlin/JVM</code>:</p><ul><li>проверяет <code>input</code>-директории, убеждается, что они вообще есть. Если нет - пропустит задачу с причиной: <code>no source files</code></li><li>смотрит, есть ли у него в кеше результат для этого набора файлов? Если есть - возвращает результат</li><li>если кеша не оказалось, пойдет вызывать <code>:assembleDevDebug</code> для компилятора <code>Kotlin/JVM</code>, передавая следующие параметры: какие файлы нужно компилировать, путь до директории, в которой можно хранить промежуточные файлы компиляции, путь до директории, где будет находится результат компиляции и тд. </li><li>вызывается компилятор <code>Kotlin/JVM</code>. Перед компиляцией каждого файла, который ему сказал скомпилировать <code>Gradle</code> он проверяет, есть ли в его директории промежуточных файлов компиляции для этого проекта, результат для нужного файла. Если нужный файлик есть - берет его, если файла нет или он изменился - компилирует.</li><li>когда все закончил - отдает гредлу результат</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="сборка-ios">Сборка iOS<a class="hash-link" href="#сборка-ios" title="Direct link to heading">​</a></h2><p>Сборкой <code>Kotlin-кода</code> для <code>iOS</code> приложения  вместе с <code>Gradle</code> занимается <code>Kotlin/Native</code>, который не поддерживает инкрементальную компиляцию. По сути, мы собираем библиотеку &quot;Общий код&quot;, которую будем подключать к <code>iOS</code> приложению. Во время сборки <code>iOS</code> приложения мы можем ориентироваться только на кеши гредла и на статические кеши компилятора <code>Kotlin/Native</code>.  </p><p><strong><em>Для начала разберем, как происходит сборка с нуля:</em></strong> </p><ol><li>Так как мы собираем библиотеку - она состоит из модулей фичи, зависимостей и прочих. Все эти модули сначала компилируются в <code>kLib</code> (<code>gradle task</code> - <code>:compileKotlinIosX64</code>). Это промежуточные файлы компиляции, они не содержат в себе итоговый бинарник. Это то, из чего <code>Kotlin/Native</code> впоследствии будет собирать итоговый <code>framework</code>.</li><li>После сборки каждого <code>kLib</code> градл сохраняет себе её кеш по хешу исходников. </li><li>Когда все <code>kLib</code>-ы собраны, градл запускает таску <code>:linkFramework</code> собирать итоговый бинарник. <code>Kotlin/Native</code> начинает собирать итоговый бинарник: сначала собирает бинарник каждого <code>kLib</code> и кеширует его себе. Это и есть его статический кеш.</li><li>Затем компилятор линкует все полученные бинарники в один итоговый, для конкретной системы и возвращает результат гредлу</li></ol><p><strong><em>Как происходят последующие сборки:</em></strong></p><ol><li>градл подряд для всех модулей запускает задачи (<code>:compileKotlinIosX64</code> или <code>:compileKotlinIosArm64</code>) для компиляци <code>kLib</code> </li><li>если по текущему хешу модуля не лежит никакой <code>kLib</code>, значит модуль изменился и надо сделать новый <code>kLib</code></li><li><code>Kotlin/Native</code> делает новую <code>kLib</code>, если градл не смог взять ее из кеша. Далее отдает ее гредлу, тот сохраняет ее себе по новому хешу</li><li>когда собрались все <code>kLib</code>, градл запускает задачку(<code>:linkFramework</code>): собирать <code>framework</code>(библиотеку) и передает все актуальные <code>kLib</code></li><li><code>Kotlin/Native</code> по хешу пришедших <code>kLib</code> определяет, есть у него для нее закешированный собранный бинарник или нет, если есть - берет его, если нет - собирает и сохраняет себе по новому хешу <code>kLib</code>. Потом из всех бинарников собирает итоговый </li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="пример">Пример<a class="hash-link" href="#пример" title="Direct link to heading">​</a></h2><p>У нас есть 6 модулей. Модулю <code>A</code> для компиляции нужен модуль <code>B</code>, которому, в свою очередь, нужны <code>C</code> и <code>D</code>, а модулю <code>C</code> нужны <code>F</code> и <code>E</code>. Зависимости модулей друг от друга также представлены на графе:</p><div class="mermaid">    flowchart TD
     A --&gt; B
     B --&gt; C
     C --&gt; F
     B --&gt; D
     C --&gt; E</div><p>Посмотрим, как будет происходить сборка приложения для <code>iOS</code> и <code>Android</code> в двух случаях:</p><ul><li>Разработчик сделал изменение в <code>public api</code> модуля <code>F</code>. Например, в публичной функции какого-нибудь класса модуля F, которую, соответственно, могут использовать за пределами файла, в котором она объявлена  </li><li>Разработчик сделал изменение в <code>private api</code> модуля <code>F</code>.Например, в приватной функции какого-нибудь класса модуля F, которая, соответственно, может быть использована только в файле, в котором она объявлена</li></ul><table><thead><tr><th>api</th><th>Платформа</th><th>Выводы gradle</th><th>Выводы компилятора</th><th>Какие модули будут собираться</th><th>Время сборки</th></tr></thead><tbody><tr><td>private</td><td>Android</td><td>source-файлы изменились, значит нельзя ориентироваться на то, что я (gradle) собрал ранее. Hash модуля <code>F</code> изменился, пойду дам задачу компилятору <code>Kotlin/JVM</code>, чтобы собрал модуль <code>F</code>. После того, как компилятор соберет модуль <code>F</code>, я скажу ему собирать все модули, которые зависят от <code>F</code>, т.к. он изменился, это: <code>С</code>, <code>B</code> и <code>A</code> (задача компиляции для каждого модуля своя)</td><td>Первая задача, которую я (Kotlin/JVM) получил от гредла - компилировать модуль <code>F</code>. Ориентируясь на свои кеши инкрементальной компиляции я вижу, что изменения коснулись лишь одного файла, сами изменения находятся в <code>private api</code>. Поэтому, я пересоберу только этот файлик в модуле <code>F</code> и верну его гредлу. После этого, по очереди получу задачи компилировать модули <code>С</code>, <code>B</code> и <code>A</code>. Перекомпиливать их я не буду, потому что по своим кешам вижу, что модули не изменились, верну кеши.</td><td>Один файл из модуля <code>F</code></td><td>очень быстро</td></tr><tr><td>public</td><td>Android</td><td>Вывод точно такой же, как выше</td><td>Если в модуле <code>F</code> произошло добавление нового <code>public api</code>, которое еще нигде не используется, то пересоберется только изменившийся файл, в который оно добавилось. Если же произошло удаление или изменение <code>public api</code>, которое использовалось в каком-то другом модуле, то вместе с изменившимся файлом пересоберутся и все те, которые используют это изменившееся <code>public api</code></td><td>Как минимум изменившийся файл модуля <code>F</code>, как максимум еще файлы других модулей, где используется изменившееся <code>public api</code></td><td>быстро</td></tr><tr><td>public/private</td><td>iOS</td><td>Вывод аналогичный тому, что выше, только вызываться будет компилятор <code>Kotlin/Native</code></td><td>Получил от <code>gradle</code> задачу собирать модуль <code>F</code>. Собрал, отдал, получил по очереди задачи собирать зависящие на <code>F</code> модули: <code>A</code>, <code>B</code>, <code>C</code></td><td><code>A</code>, <code>B</code>, <code>C</code>, <code>F</code></td><td>медленно</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="как-разбить-проект-на-модули">Как разбить проект на модули?<a class="hash-link" href="#как-разбить-проект-на-модули" title="Direct link to heading">​</a></h2><p>Как правило, модули в проектах - это либо фичи, либо какие-то модели данных и классы, которые используют разные фичи, разберем каждый из них: </p><ul><li><p><strong><em>Фича</em></strong></p><ul><li>фича подразумевает под собой какую-то часть логики приложения, поэтому новая фича - это всегда новый модуль. Например, приложение социальной сети имеет следующие фичи:<ul><li>авторизации (все, что связано со входом приложение: регистрация, логин, сброс пароля и тд)</li><li>лента новостей и все действия с ней </li><li>профиль и все действия с ним</li><li>настройки приложения </li><li>и т.д</li></ul></li></ul><p>Важно понимать, что фича - это не всегда один экран. Поэтому зачастую модуль ≠ экран.<br>
<!-- -->Чтобы было проще проектировать фичи и понимать, что должно находиться в ней постарайтесь представить, как будет выглядеть приложение, если из него целиком убрать модуль какой-нибудь фичи. Если в приложении не осталось ничего, что как-то напоминает логику убранной фичи - значит фича спроектирована правильно.<br>
<!-- -->Последнее замечание - модуль фичи никогда не должен ссылаться на модули других фичей, потому что тогда в разбиении проекта на модули не будет никакой пользы.</p></li><li><p><strong><em>Функционал, общий для нескольких фичей</em></strong><br>
<!-- -->Часто так бывает, что какая-то модель данных нужна нескольким фичам сразу, например: класс <code>WallPost</code> - какой-либо пост в социальной сети, пригодится как в фиче новостей, так и в фиче просмотра конкретной страницы, потому что посты могут быть и там и там.</p><p>  Что следует выносить в общий модуль, а что предоставлять фиче как <code>Dependency injection</code>: </p><ul><li>Если видите, что какая-то структура или модель данных понадобится нескольким фичам, вынесите её в новый модуль</li><li>Если вы в процессе разработки подцепляете в модуле <code>A</code> модуль <code>B</code>, чтобы использовать какую-то его модель данных - сразу выносите эту модель в один модуль</li><li>Если то, что мы хотим использовать в нескольких фичах реализуется без зависимостей на другие модули - выносите в модуль. (упрощает DI: не надо никаких новых интерфейсов, не надо ничего никуда прокидывать и тд) </li><li>Если в этом функционале есть какие-то зависимости от других модулей, то такой функионал следует подключать в mppLibrary к нужным фичам как <code>Dependency injection</code> или <code>Dependency inversion</code>   </li><li>Также, следите за тем, чтобы модули не зависели от тех, которые часто меняются. Например, если в модуле будут лежать строки локализации, которые стабильно пополняются и меняются на протяжении всей разработки проекта. Это приведет к тому, что зависящий от него модуль будет пересобираться каждый раз, когда добавляется или исчезает строка локализации </li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="shaper">Shaper<a class="hash-link" href="#shaper" title="Direct link to heading">​</a></h2><p>Любое приложение - это набор фичей. Значит, часто приходится добавлять новые.<br>
<!-- -->Проблема - когда требуется создать новую фичу, то нужно сделать множество рутинных действий:</p><ol><li>Создать директорию под новую фичу</li><li>Скопировать с другой фичи <code>build.gradle</code> для новой</li><li>Завести директорию <code>src/commonMain/kotlin</code> со структурой пакетов по <code>packageId</code> модуля<ol><li><code>di</code></li><li><code>model</code></li><li><code>presentation</code></li></ol></li><li>Завести <code>src/androidMain/AndroidManifest.xml</code> с указанием там уникального <code>packageId</code></li><li>Добавить <code>include</code> фичи в <code>settings.gradle</code> </li><li>Подключить фичу в <code>mpp-library</code></li></ol><p>Это только начало создания фичи, далее потребуется создать <code>layout</code>-файлы, <code>Fragment</code>-ы для <code>Android</code>, <code>ViewController</code>-ы для <code>iOS</code> и многое другое.<br>
<!-- -->Чтобы не заниматься этим каждый раз вручную, мы в IceRock сделали генератор, который позволяет создать фичу, модуль, фрагмент, контроллер и прочее всего в несколько кликов!</p><p>Генератор - <a href="https://github.com/icerockdev/shaper/" target="_blank" rel="noopener noreferrer">Shaper</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="практическое-задание">Практическое задание<a class="hash-link" href="#практическое-задание" title="Direct link to heading">​</a></h2><ul><li>Используйте проект, созданный в разделе <a href="/university/icerock-basics/mobile-moko-boilerplate#%D0%BF%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5">Шаблон для новых проектов</a></li><li>Добавьте две фичи вашего приложения (это заготовки на будущее, пока не переносите код из практики третьего блока)<ul><li><strong>фича авторизации</strong> - добавьте её в проект вручную</li><li><strong>фича репозиториев</strong> - её добавьте в проект при помощи <a href="https://github.com/icerockdev/shaper/" target="_blank" rel="noopener noreferrer">shaper</a>, используйте <a href="https://gitlab.icerockdev.com/scl/boilerplate/mobile-shaper-templates/-/blob/master/kmm/kmm-feature.yaml" target="_blank" rel="noopener noreferrer">шаблон</a> для создания новой фичи. Рекомендуем сначала попробовать сделать это самостоятельно, не пользуясь <a href="/university/memos/shaper">Памяткой</a>.</li></ul></li><li>Убедитесь, что проект компилируется</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/icerockdev/kmm.icerock.dev/tree/docusaurus/university/4-icerock-basics/multimodularity.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/university/icerock-basics/gradle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Gradle</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/university/icerock-basics/moko-libs-intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Введение в MOKO библиотеки</div></a></nav><br></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#многомодульность-1" class="table-of-contents__link toc-highlight">Многомодульность</a></li><li><a href="#сборка-android" class="table-of-contents__link toc-highlight">Сборка Android</a></li><li><a href="#сборка-ios" class="table-of-contents__link toc-highlight">Сборка iOS</a></li><li><a href="#пример" class="table-of-contents__link toc-highlight">Пример</a></li><li><a href="#как-разбить-проект-на-модули" class="table-of-contents__link toc-highlight">Как разбить проект на модули?</a></li><li><a href="#shaper" class="table-of-contents__link toc-highlight">Shaper</a></li><li><a href="#практическое-задание" class="table-of-contents__link toc-highlight">Практическое задание</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">IceRock Development</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Site</a></li><li class="footer__item"><a href="https://github.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://www.facebook.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://vk.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">VK</a></li><li class="footer__item"><a href="https://www.instagram.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-Vhmm09W_IWKHhSg80d68w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a href="https://twitter.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter @icerockdev<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/kotlinmpp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmpp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/kotlinmppchats" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmppchats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kotlinlang.org/lp/mobile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Mobile<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://libs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Libs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://codelabs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Codelabs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://moko.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">MOKO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/native-overview.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin/Native Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/multiplatform.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 IceRock Development. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.22da4016.js"></script>
<script src="/assets/js/main.2311b54d.js"></script>
</body>
</html>