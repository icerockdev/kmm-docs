<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-learning docs-doc-id-ios/limited-gallery-ios14">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-91G2XYQTXS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-91G2XYQTXS",{})</script><title data-rh="true">Лимитированная библиотека фото в iOS 14 | Kotlin Multiplatform Mobile</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kmm.icerock.dev/learning/ios/limited-gallery-ios14"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-learning-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-learning-current"><meta data-rh="true" property="og:title" content="Лимитированная библиотека фото в iOS 14 | Kotlin Multiplatform Mobile"><meta data-rh="true" name="description" content="iOS 14 с новой настройкой конфиденциальности:"><meta data-rh="true" property="og:description" content="iOS 14 с новой настройкой конфиденциальности:"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kmm.icerock.dev/learning/ios/limited-gallery-ios14"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/learning/ios/limited-gallery-ios14" hreflang="en"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/learning/ios/limited-gallery-ios14" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.893f3d2c.css">
<link rel="preload" href="/assets/js/runtime~main.518f9668.js" as="script">
<link rel="preload" href="/assets/js/main.3aac4c1b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/onboarding/intro">Onboarding</a><a class="navbar__item navbar__link navbar__link--active" href="/learning/intro">Knowledge Base</a><a class="navbar__item navbar__link" href="/university/intro">University</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/icerockdev/kmm.icerock.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/intro">О разделе</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/code-style/general-rules">CodeStyle</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/gradle/intro-gradle">Gradle</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/android/study-materials">Android</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/learning/ios/study-materials">iOS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/study-materials">Материалы для обучения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/background_state">Background State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/configuration">Конфигурации сборки проекта</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/corners">Layer corners</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/crypt-xcframework">Шифрование файлов при поставке готового XCFramework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/dispatchqueue">Dispatch Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/firebase_cloud_messaging">Firebase Cloud Messaging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/forced_fcm_invalidation">Forced FCM-token invalidation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/ios-builds">Simulator Builds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/life-cycle-and-communication-patterns-in-swiftui">Жизненный цикл и cпособы передачи данных в SwiftUI.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/learning/ios/limited-gallery-ios14">Лимитированная библиотека фото в iOS 14</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/navigation">Навигация</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/pods">CocoaPods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/proxyman-tutorial">Proxyman - tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/sign_in_with_apple">Sign in with Apple</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/static-dynamic-libs">Статические и динамические библиотеки/фреймворки в iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/tips_and_tricks">Xcode: Tips and Tricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/xcode-environment-variables">Xcode - environment variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/xcode">Xcode</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/kotlin/study-materials">Kotlin</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/compose-multiplatform/links">Compose Multiplatform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/kotlin-multiplatform/how-to-start">Kotlin Multiplatform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/kotlin-native/summary">Kotlin/Native</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/libraries/kotlinx/coroutines">Библиотеки</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/problem-solving/gradle-daemon-crash">Решения проблем</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/memory_management">Работа с памятью</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/concurrency">Многопоточность</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/state">Единый стейт экрана</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/socket">Socket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/links">Ссылки</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/code">Примеры кода</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/movement_workspace_dir">Перенос dev tools на другой диск</a></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">iOS</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Лимитированная библиотека фото в iOS 14</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Лимитированная библиотека фото в iOS 14</h1><p><strong>iOS 14 с новой настройкой конфиденциальности:</strong></p><p>Фотографии и видео пользователя являются одними из самых личных данных, которые он хранит на своих устройствах. Благодаря встроенной защите конфиденциальности приложение может получить доступ к библиотеке фотографий пользователя только в том случае, если оно явно разрешит ему это сделать. Начиная с iOS 14, PhotoKit еще больше улучшает контроль конфиденциальности пользователей с добавлением ограниченной библиотеки &quot;Фото&quot;, которая позволяет пользователям выбирать конкретные ресурсы (фото, видео) для совместного использования с приложением.</p><p><em>Важно:<br>Ограниченная библиотека фотографий затрагивает все приложения, которые используют PhotoKit в iOS 14, включая те, которые уже опубликованы в App Store. Оцените поведение вашего приложения, чтобы убедиться, что оно работает должным образом при запуске в ограниченном библиотечном режиме.</em></p><p><strong>PHPickerViewController</strong></p><p>Также с выходом iOS 14 был представлен PHPickerViewController -  view controller, который предоставляет пользовательский интерфейс для выбора ресурсов из библиотеки фотографий (PHPickerViewController является альтернативой UIImagePickerController). Его пользовательский интерфейс соответствует интерфейсу приложения &quot;Фото&quot;, поддерживает поиск и множественный выбор фотографий и видео, а также обеспечивает плавное масштабирование контента. Поскольку система управляет своим жизненным циклом в отдельном процессе, по умолчанию она является частной, поэтому пользователю не нужно явно разрешать приложению выбирать фотографии (тут имеется ввиду, что если ваше приложение не сохраняет ничего в приложение &quot;Фото&quot;, а только берет оттуда ресурсы, то явно запрашивать доступ не нужно).</p><p><a href="https://developer.apple.com/videos/play/wwdc2020/10652/" target="_blank" rel="noopener noreferrer">Познакомьтесь с новым сборщиком фотографий</a></p><p><em>Важно:<br>Так как iOS 14 с новой настройкой конфиденциальности и PHPickerViewController были представлены практически в одно время, то PHPickerViewController внес немалую путаницу для разработчиков, так как многие подумали, что именно PHPickerViewController должен показывать ограниченную библиотеку фотографий, на самом деле это не так. PHPickerViewController позволяет только выбрать ресурсы (фото, видео) - открыть интерфейс управления для ограниченной библиотеки, но саму ограниченую библиотеку вам нужно сделать самостоятельно (создать собственный ViewController, отвечающий за показ ограниченной библиотеки).</em></p><p>Если вашему приложению требуются расширенные функции PhotoKit, такие как получение ресурсов и коллекций или обновление библиотеки, пользователь должен явно разрешить ему доступ к этим функциям, то предоставьте локализуемое сообщение, описывающее, как ваше приложение взаимодействует с библиотекой фотографий.</p><p><img loading="lazy" alt="limited-gallery-demo-1.png" src="/assets/images/limited-gallery-demo-1-1b532896730e1df6f8b350917051525b.png" width="1000" height="570" class="img_E7b_"></p><p><em>Важно:<br>Система представляет это локализуемое сообщение пользователю, когда предлагает ему авторизовать ваше приложение для доступа. Попытка доступа к библиотеке фотографий без действительного описания использования приводит к сбою вашего приложения.</em></p><p><strong>Работа с ограниченной библиотекой:</strong></p><p>В предыдущих выпусках iOS пользователи либо разрешали, либо запрещали полный доступ к своей библиотеке. Большинство пользователей не хотят предоставлять приложениям полный доступ к своим личным данным, и начиная с iOS 14, они могут делиться ограниченным подмножеством своих фотографий и видео. Когда приложение запрашивает авторизацию, система запрашивает у пользователя диалоговое окно, подобное показанному ниже.</p><p><img loading="lazy" alt="limited-gallery-demo-2.png" src="/assets/images/limited-gallery-demo-2-15451be902ea5e19809df910a586b3a2.png" width="564" height="523" class="img_E7b_"></p><p>В дополнение к кнопкам, разрешающим или запрещающим доступ, есть новая опция выбора фотографий, которую пользователь может нажать, чтобы открыть интерфейс управления ограниченной библиотекой. Этот интерфейс позволяет пользователю выбрать ресурсы для совместного использования с вашим приложением. Выбранные элементы представляют собой ограниченный выбор библиотеки пользователя, ваше приложение может получить доступ только к этим ресурсам.</p><p>API PhotoKit в основном работают одинаково независимо от того, взаимодействует ли ваше приложение с полной библиотекой фотографий или только с ограниченным выбором библиотеки пользователя. Однако имейте в виду следующие исключения:</p><p>• Система автоматически добавляет ресурсы, которые ваше приложение создает с помощью PHAsset, в ограниченный выбор библиотеки пользователя.</p><p>• Вы не можете создавать или извлекать пользовательские альбомы. Если вашему приложению требуется эта функция, вам нужно будет соответствующим образом обновить его поведение и пользовательский интерфейс, когда статус авторизации вашего приложения PHAuthorization.limited</p><p>По умолчанию система автоматически предлагает пользователю обновить ограниченный выбор библиотек один раз за жизненный цикл приложения. Эта автоматическая презентация не является предпочтительным пользовательским интерфейсом для большинства приложений. Вместо этого приложения должны подавить автоматическое приглашение и представить его программно:</p><p><img loading="lazy" alt="limited-gallery-demo-3.png" src="/assets/images/limited-gallery-demo-3-2fa0cc348f3e7653f6dd120751cb850f.png" width="1326" height="244" class="img_E7b_"></p><p>Чтобы представить селектор ограниченных библиотек программно, добавьте доступность в свой пользовательский интерфейс (кнопка и т.п.), чтобы пользователь мог обновить свой ограниченный выбор библиотеки. Когда пользователь нажимает на этот интерфейс, модально откроется селектор для выбора ресурсов для ограниченной библиотеки, как показано в следующем коде:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let viewController = // UIViewController с которого модально откроется селектор для выбора ресурсов ограниченной библиотеки.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PHPhotoLibrary.shared().presentLimitedLibraryPicker(from: viewController)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Наблюдение за изменением библиотеки:</strong></p><p>Чтобы отслеживать изменения в ограниченном выборе библиотеки пользователя, используйте стандартный API наблюдателя изменений, <a href="https://developer.apple.com/documentation/photokit/phphotolibrary/observing_changes_in_the_photo_library" target="_blank" rel="noopener noreferrer">как описано в разделе наблюдение за изменениями в библиотеке фотографий</a>.<br>
<!-- -->Зарегистрируйте свое приложение, чтобы получать уведомления, поскольку система уведомляет его об изменениях состояния:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override func viewDidLoad() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.viewDidLoad()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Observing Changes in the Photo Library</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        PHPhotoLibrary.shared().register(self)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>А также подпишитесь под протокол PHPhotoLibraryChangeObserver, чтобы обновлять пользовательский интерфейс:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension GalleryViewController: PHPhotoLibraryChangeObserver {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    func photoLibraryDidChange(_ changeInstance: PHChange) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        guard let changeResults = changeInstance.changeDetails(for: fetchResult) else { return }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fetchResult = changeResults.fetchResultAfterChanges</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        DispatchQueue.main.async {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.collectionView.reloadData()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Какие локализуемые сообщения в Info.plist нужно использовать и в каких случаях:</strong></p><p>• Если вы используете новый PHPickerViewController и вам не нужна лимитированная библиотека, а вашему приложению нужно, например, просто брать ресурсы из приложения &quot;Фото&quot; и сохранять в ваше приложение, то никаких локализуемых запросов делать не нужно.</p><p>• Если вы используете старый UIImagePickerController, то вам следует использовать: &quot;Privacy - Photo Library Additions Usage Description = &quot;Need access to photo library for save&quot; (лимитированная библиотека с этим доступом не работает)</p><p><img loading="lazy" alt="limited-gallery-demo-4.png" src="/assets/images/limited-gallery-demo-4-3122333b28b5f24835146ff96110caa9.png" width="1326" height="244" class="img_E7b_"></p><p>В этом случае на экране вы увидите следующее:</p><p><img loading="lazy" alt="limited-gallery-demo-5.png" src="/assets/images/limited-gallery-demo-5-aafd716ca4fe0892d167b6ab55c41500.png" width="361" height="640" class="img_E7b_"></p><p>• Если вы используете PHPickerViewController и вам нужна лимитированная библиотека, следует использовать: Privacy - Photo Library Usage Description = &quot;Need access to photo library&quot;, при этом предпочтительно следует использовать &quot;Prevent limited photos access alert = YES&quot; (прочитайте еще раз об этом выше &quot;Работа с ограниченной библиотекой&quot;)</p><p><img loading="lazy" alt="limited-gallery-demo-6.png" src="/assets/images/limited-gallery-demo-6-fe330d114f9524a6bb2e7195d8f7dbbe.png" width="1326" height="244" class="img_E7b_"></p><p>В этом случае на экране вы увидите следующее:</p><p><img loading="lazy" alt="limited-gallery-demo-7.png" src="/assets/images/limited-gallery-demo-7-85938d5db92134cf02b04abccaa277f4.png" width="361" height="640" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ссылки">Ссылки:<a class="hash-link" href="#ссылки" title="Direct link to heading">​</a></h2><p><strong>AccessPhotoLibraryManager:</strong></p><p>По этой ссылке вы можете ознакомиться с AccessPhotoLibraryManager, который работает с новым PHPhotoLibrary.requestAuthorization для iOS 14, а также с его старой версией.<br>
<a href="https://github.com/bullinnyc/PhotoGallery/blob/main/Gallery/Services/AccessPhotoLibraryManager.swift" target="_blank" rel="noopener noreferrer">AccessPhotoLibraryManager</a></p><p><strong>PhotoManager:</strong></p><p>По этой ссылке вы можете ознакомиться с PhotoManager, который получает ресурсы для лимитированной библиотеки. Особое внимание стоит уделить PHImageRequestOptions, в нем можно управлять настройками получения ресурсов.<br>
<a href="https://github.com/bullinnyc/PhotoGallery/blob/main/Gallery/Services/PhotoManager.swift" target="_blank" rel="noopener noreferrer">PhotoManager</a></p><p><strong>GalleryApp:</strong></p><p>Ссылка на проект с готовой галереей, поддерживающей лимитированную библиотеку. Ресурсы берутся из приложения &quot;Фото&quot; пользователя. Здесь можно поэкспериментировать c настройками, запросами и более подробно понять как работает лимитированная галерея.<br>
<a href="https://github.com/bullinnyc/PhotoGallery" target="_blank" rel="noopener noreferrer">GalleryApp</a></p><p><strong>Источник:</strong></p><p><a href="https://developer.apple.com/documentation/photokit/delivering_an_enhanced_privacy_experience_in_your_photos_app" target="_blank" rel="noopener noreferrer">Delivering an Enhanced Privacy Experience in Your Photos App</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/icerockdev/kmm.icerock.dev/tree/docusaurus/learning/ios/limited-gallery-ios14.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/learning/ios/life-cycle-and-communication-patterns-in-swiftui"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Жизненный цикл и cпособы передачи данных в SwiftUI.</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/learning/ios/navigation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Навигация</div></a></nav><br></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ссылки" class="table-of-contents__link toc-highlight">Ссылки:</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">IceRock Development</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Site</a></li><li class="footer__item"><a href="https://github.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://www.facebook.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://vk.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">VK</a></li><li class="footer__item"><a href="https://www.instagram.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-Vhmm09W_IWKHhSg80d68w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a href="https://twitter.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter @icerockdev<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/kotlinmpp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmpp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/kotlinmppchats" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmppchats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kotlinlang.org/lp/mobile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Mobile<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://libs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Libs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://codelabs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Codelabs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://moko.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">MOKO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/native-overview.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin/Native Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/multiplatform.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 IceRock Development. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.518f9668.js"></script>
<script src="/assets/js/main.3aac4c1b.js"></script>
</body>
</html>